{% extends theme('layout.html') %}
{% block head %}{{ super() }}{% endblock %}

{% block carousel %}
{% include theme('_carousel_home.html') %}
{% endblock %}

{% block content %}
<div class="row margin0">
  <div id="post" class="col-sm-9">
    <div>
      {% for post in content.post_roll %}
      <div class="post-summary-box">
        <div class="post-summary-content">
          <div class="post-title-box">
            <div class="post-title">
              <h3><a rel="bookmark" title="{{ post.title }}" href="{{ post.link }}">{{ post.title }}</a></h3>
            </div>
            {% include theme('_post_metabar.html') %}
            <div class="post-excerpt">{{ post.excerpt|codeblock|safe }}</div>
          </div>
          <a class="continue_reading_link" title="查看 <<{{ post.title }}>> 全文" href="{{ post.link }}"> Continue Reading →</a>
        </div>
      </div>
      {% endfor %}
    </div>

    <div id="pagination">
      {% set page=content.page %}
      {% set view_args = request.view_args %}

      {#!!!   {% do view_args.pop('page_num') %}   jinja's bug! !!!#}
      {% if 'page_num' in view_args %}
      {% set none_none=view_args.pop('page_num') %}
      {% endif %}

      {% set keywords=request.args.get('keywords') %}

      {% if page.has_prev %}
      <span class="prev-entries">
        <a href="{% if keywords == None %}{{ url_for(page.view_name, page_num=page.prev_num, **view_args) }}{% else %}{{ url_for(page.view_name, page_num=page.prev_num, **view_args) }}?keywords={{keywords}}{% endif %}">← Previous Entries</a>
      </span>
      {% endif %}

      {% if page.has_next %}
      <span class="next-entries">
        <a href="{% if keywords == None %}{{ url_for(page.view_name, page_num=page.next_num, **view_args) }}{% else %}{{ url_for(page.view_name, page_num=page.next_num, **view_args) }}?keywords={{keywords}}{% endif %}">Next Entries →</a>
      </span>
      {% endif %}
    </div>
  </div>

  <div id="sidebar" class="col-sm-3"> {% include theme('_sidebar.html') %}</div>
</div>
{% endblock %}
